CREATE DATABASE LEILAO;
 
USE LEILAO;

CREATE TABLE USUARIO(
	id SERIAL NOT NULL, 
	login VARCHAR(30) NOT NULL,
	nome VARCHAR(80) NOT NULL,
	cpf VARCHAR(20) NOT NULL,
	senha VARCHAR(30) NOT NULL,
	setor VARCHAR(30) NOT NULL,

	PRIMARY KEY (id)
	
);

CREATE TABLE CATEGORIA(
	id SERIAL NOT NULL, 
	nome VARCHAR(80) NOT NULL,

	PRIMARY KEY (id)
	
);

CREATE TABLE FORNECEDOR(
	id SERIAL NOT NULL, 
	nome_fantasia VARCHAR(80) NOT NULL,
	razao_social VARCHAR(80) NOT NULL,
	cnpj VARCHAR(30),
	cpf VARCHAR(20),
	email VARCHAR(80) NOT NULL,
	endereco VARCHAR(80) NOT NULL,
	cep VARCHAR(20) NOT NULL,
	telefone1 VARCHAR(20) NOT NULL,
	telefone2 VARCHAR(20),
	responsavel VARCHAR(80) NOT NULL,
	login VARCHAR(30) NOT NULL,
	senha VARCHAR(30) NOT NULL,

	PRIMARY KEY (id)
	
);

CREATE TABLE PRODUTO(
	id SERIAL NOT NULL, 
	nome VARCHAR(80) NOT NULL,
	marca VARCHAR(80) NOT NULL,
	id_categoria INT NOT NULL,

	PRIMARY KEY (id),
	FOREIGN KEY (id_categoria) REFERENCES CATEGORIA(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);

CREATE TABLE PEDIDO_COMPRA(
	id SERIAL NOT NULL, 
	data_inicio DATE NOT NULL,
	data_fim DATE NOT NULL,
	is_interno BOOLEAN NOT NULL,
	id_usuario NOT NULL,

	PRIMARY KEY (id),
	FOREIGN KEY (id_usuario) REFERENCES USUARIO(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);

CREATE TABLE FORNECEDOR_CATEGORIA( 
	id_categoria INT NOT NULL,
	id_fornecedor INT NOT NULL,

	PRIMARY KEY (id_categoria, id_fornecedor),
	FOREIGN KEY (id_categoria) REFERENCES CATEGORIA(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	FOREIGN KEY (id_fornecedor) REFERENCES FORNECEDOR(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);

CREATE TABLE ITEM( 
	id SERIAL NOT NULL,
	id_pedido_compra INT NOT NULL,
	id_produto INT NOT NULL,
	quantidade INT NOT NULL,

	PRIMARY KEY (id, id_pedido_compra),
	FOREIGN KEY (id_pedido_compra) REFERENCES PEDIDO_COMPRA(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	FOREIGN KEY (id_produto) REFERENCES PRODUTO(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);

CREATE TABLE LANCE( 
	id_item INT NOT NULL,
	id_pedido_compra INT NOT NULL,
	id_fornecedor INT NOT NULL,
	valor FLOAT NOT NULL,

	PRIMARY KEY (id_item, id_pedido_compra, id_fornecedor),
	FOREIGN KEY (id_item) REFERENCES ITEM(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	FOREIGN KEY (id_pedido_compra) REFERENCES PEDIDO_COMPRA(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	FOREIGN KEY (id_fornecedor) REFERENCES FORNECEDOR(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);

CREATE TABLE PROPOSTA( 
	id_pedido_compra INT NOT NULL,
	id_fornecedor INT NOT NULL,
	total FLOAT NOT NULL,
	prazo_entrega INT NOT NULL,
	quantidade_parcelas INT NOT NULL,
	data DATE NOT NULL,
	is_fora_padrao BOOLEAN NOT NULL,

	PRIMARY KEY (id_pedido_compra, id_fornecedor),
	FOREIGN KEY (id_pedido_compra) REFERENCES PEDIDO_COMPRA(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	FOREIGN KEY (id_fornecedor) REFERENCES FORNECEDOR(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);

CREATE TABLE NOTA( 
	id SERIAL NOT NULL,
	id_usuario INT NOT NULL,
	id_fornecedor INT NOT NULL,
	nota INT NOT NULL,
	descricao VARCHAR(150) NOT NULL,

	PRIMARY KEY (id, id_usuario),
	FOREIGN KEY (id_usuario) REFERENCES USUARIO(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE,
	FOREIGN KEY (id_fornecedor) REFERENCES FORNECEDOR(id)
	ON DELETE CASCADE
	ON UPDATE CASCADE
);
